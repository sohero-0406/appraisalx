<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jeesite.modules.aa.dao.ExamResultsDetailDao">
	
	<!-- 查询数据
	<select id="findList" resultType="ExamResultsDetail">
		SELECT ${sqlMap.column.toSql()}
		FROM ${sqlMap.table.toSql()}
		<where>
			${sqlMap.where.toSql()}
		</where>
		ORDER BY ${sqlMap.order.toSql()}
	</select> -->

	<resultMap id="findDataMap" type="TechnologyInfo">
		<id property="id" column="id"></id>
		<result property="name" column="name"></result>
		<collection property="itemList" ofType="IdentifyTecDetail">
			<id property="technologyInfoId" column="technologyInfoId"></id>
			<result property="typeName" column="technologyInfoName"></result>
			<result property="stuOrTec" column="stuOrTec"></result>
			<result property="code" column="code"></result>
		</collection>
	</resultMap>
	<select id="getExamResults" resultMap="findDataMap">

			select
			 tecInfo.id,
			 tecInfo.name,
			 a.id  as technologyInfoId,
			 a.name as technologyInfoName,
			 a.stuOrTec as stuOrTec,
			 a.code,
			 a.deduct_num
			from
			((SELECT
			detail.id,
			tec.paper_id as stuOrTec,
			detail.degree,
			detail.deduct_num,
			detail.code,
			detail.technology_info_id,
			info.name
			from
			aa_identify_tec tec
			left join aa_identify_tec_detail detail on detail.indentity_tec_id = tec.id
			left join aa_technology_info info on info.id = detail.technology_info_id
			where tec.paper_id = #{paperId} )
			UNION All
			(SELECT
			detail.id,
			tec.exam_user_id as stuOrTec,
			detail.degree,
			detail.deduct_num,
			detail.code,
			detail.technology_info_id,
			info.name
			from
			aa_identify_tec tec
			left join aa_identify_tec_detail detail on detail.indentity_tec_id = tec.id
			left join aa_technology_info info on info.id = detail.technology_info_id
			where tec.exam_user_id = #{examUserId}  ) ) a
			left join aa_technology_info tecInfo on tecInfo.id = a.technology_info_id

	</select>

	<select id="getCheckBodySkeleton" resultType="CheckBodySkeleton">
			select
			body.exam_user_id,
			body.paper_id,
			body.state,
			body.description,
			body.technology_info_id as project,
			(
			select data.dict_label from js_sys_dict_data  data
			where data.dict_type = 'aa_car_body_skeleton' and data.dict_value = body.technology_info_id
			) as projectName
			from
			aa_check_body_skeleton  body
			<where>
				<if test="paperId != null and paperId != ''">
					and body.paper_id = #{paperId}
				</if>
				<if test="examUserId != null and examUserId != ''">
					and body.exam_user_id = #{examUserId}
				</if>
			</where>
	</select>

	<select id="getCarBodyDic" resultType="java.util.Map">
			select  dict_label,dict_value from js_sys_dict_data where dict_type = 'aa_car_body_skeleton'
	</select>

	
</mapper>